const bay=()=>{"use strict";function e(){const e=new CustomEvent("bay_global_event");window.dispatchEvent(e)}function t(e){return"string"==typeof e?(A.textContent=e,A.innerHTML.replaceAll('"',"&quot;").replaceAll("'","&#39;")):e}function r(e){return crypto.randomUUID().replaceAll("-","").substring(0,e)}function o(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function l(e){const t=[...e.querySelectorAll("[bay]")];t.forEach((e,t)=>{"dsd"===e.getAttribute("bay")&&e.setAttribute("bay",`dsd-${t}`);let r=e.getAttribute("bay");-1===g.indexOf(r)&&g.push(e)}),g.forEach(e=>{-1===$.indexOf(e.getAttribute("bay"))&&i(e),$.push(e.getAttribute("bay"))})}function n(e,t){const r=new DOMParser;let o,l;e.indexOf("<style>")>-1&&(l=e.split("<style>")[1].split("</style>")[0]),e=e.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${l}</style>`,""),o=r.parseFromString(e,"text/html"),o&&(customElements.get(t.tagName.toLowerCase())||b(o,t.tagName.toLowerCase(),a(t),l))}function s(e,t,r){const o=new DOMParser;let l,n,s=r||[];t.indexOf("<style>")>-1&&(n=t.split("<style>")[1].split("</style>")[0]),t=t.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${n}</style>`,""),l=o.parseFromString(t,"text/html"),l&&(customElements.get(e.toLowerCase())||b(l,e.toLowerCase(),s,n))}function i(e){try{const t=e.getAttribute("bay");if("dsd-"===t.substring(0,4))w=t,e.shadowRoot?n(o(e.shadowRoot.innerHTML),e):n(o(e.querySelector("template").innerHTML),e);else if("#"===t.substring(0,1)){w=t;const r=document.querySelector(t);if(!r)return void console.error(`bay: "${t}" no element found with this selector.`);n(r.innerHTML,e)}else{const r=new XMLHttpRequest;r.open("GET",t),r.setRequestHeader("Content-Type","text/plain"),r.addEventListener("load",t=>{n(t.target.responseText,e)}),r.addEventListener("error",()=>{console.error("For CORS policy errors try this: https://stackoverflow.com/questions/10752055/cross-origin-requests-are-only-supported-for-http-error-when-loading-a-local")}),r.send()}}catch(e){console.error(e)}}function a(e){let t=[];const r=[...e.attributes];return r.forEach(e=>{"bay"!==e.name&&-1===t.indexOf(e.name)&&t.push(e.name)}),t}function c(e){const t=new DOMParser,r=t.parseFromString(e,"text/html");return r.body}function d(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()}function u(e){return e.childNodes&&e.childNodes.length>0?null:e.textContent}function h(e,t){const r=Array.prototype.slice.call(t.childNodes),o=Array.prototype.slice.call(e.childNodes);let l=r.length-o.length;if(l>0)for(;l>0;l--)r[r.length-l].parentNode.removeChild(r[r.length-l]);o.forEach((e,o)=>{if(!r[o])return void t.appendChild(e.cloneNode(!0));if(d(e)!==d(r[o])){try{r[o].parentNode.replaceChild(e.cloneNode(!0),r[o])}catch(e){}return}const l=u(e);if(l&&l!==u(r[o])&&(r[o].textContent=l),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){const t=document.createDocumentFragment();return h(e,t),void r[o].appendChild(t)}e.childNodes.length>0&&h(e,r[o])}})}function p(e,t){[...t.attributes].forEach(r=>{e.value||(t.value=""),e.checked||(t.checked=!1),e.selected||(t.selected=!1),e.disabled||(t.disabled=!1),e.getAttribute(r.nodeName)||t.removeAttribute(r.nodeName)}),[...e.attributes].forEach(r=>{t.value!==e.value&&(t.value=e.value),t.checked!==e.checked&&(t.checked=e.checked),t.selected!==e.selected&&(t.selected=e.selected),t.disabled!==e.disabled&&(t.disabled=e.disabled),t.getAttribute(r.nodeName)&&t.getAttribute(r.nodeName)===r.value||t.setAttribute(r.nodeName,r.value)})}function b(e,n,s,i){let a,d,u="",b="",g=!1;try{b=e.body,u=n;const t=document.createElement(`${n}-update`);for(b.appendChild(t),(b.innerHTML.indexOf("$global.")>-1||b.innerHTML.indexOf("$global[")>-1)&&(g=!0);[...b.querySelectorAll("dsd")].length>0;){const e=[...b.querySelectorAll("dsd")];e.forEach(e=>{e.remove()})}for(b.innerHTML=b.innerHTML.replaceAll("<noscript>","").replaceAll("</noscript>","");[...b.querySelectorAll("map")].length>0;){const e=[...b.querySelectorAll("map")];e.forEach(e=>{const t=e.querySelector("map");if(!t){const t=e.getAttribute("array")||[],r=e.getAttribute("params")||"element, index, array",o=e.getAttribute("join")||"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let l=e.outerHTML;l=l.replace("<map>",`\${ ${t}.map((${r}) => { return \``).replace("</map>",`\`}).join('${o}')}`),e.outerHTML=l}})}for(;[...b.querySelectorAll("for")].length>0;){const e=[...b.querySelectorAll("for")];e.forEach(e=>{const t=e.querySelector("for");if(!t){const t=`bay_for_${r(8)}`,o=e.getAttribute("array")||[],l=e.getAttribute("params")||"element, index, array";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let n=e.outerHTML;n=n.replace("<for>",`\${(() => { let ${t} = ''; ${o}.forEach((${l}) => { ${t} += \``).replace("</for>",`\`}); return ${t}; })() }`),e.outerHTML=n}})}for(;[...b.querySelectorAll("if")].length>0;){const e=[...b.querySelectorAll("if")];e.forEach(e=>{const t=[...e.querySelectorAll("if")];if(!t.length>0){const t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"",r=e.nextElementSibling?e.nextElementSibling.tagName.toLowerCase():"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let o=e.outerHTML,l="` } return '' })() }";"else-if"!==r&&"else"!==r||(l="` }"),e.outerHTML=o.replace("<if>",`\${(() => { if (${t}) { return \``).replace("</if>",l)}})}for(;[...b.querySelectorAll("else-if")].length>0;){const e=[...b.querySelectorAll("else-if")];e.forEach(e=>{const t=[...e.querySelectorAll("else-if")];if(!t.length>0){const t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"",r=e.nextElementSibling?e.nextElementSibling.tagName.toLowerCase():"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let o=e.outerHTML,l="` } return '' })() }";"else-if"!==r&&"else"!==r||(l="` }"),e.outerHTML=o.replace("<else-if>",` else if (${t}) { return \``).replace("</else-if>",l)}})}for(;[...b.querySelectorAll("else")].length>0;){const e=[...b.querySelectorAll("else")];e.forEach(e=>{const t=[...e.querySelectorAll("else")];if(!t.length>0){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let t=e.outerHTML;e.outerHTML=t.replace("<else>"," else { return `").replace("</else>","` } return '' })() }")}})}for(;[...b.querySelectorAll("switch")].length>0;){const e=[...b.querySelectorAll("switch")];e.forEach(e=>{const t=[...e.querySelectorAll("switch")];if(!t.length>0){const t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let r=e.outerHTML;e.outerHTML=r.replace("<switch>",`\${(() => { switch (${t}) { `).replace("</switch>"," }; return '' })() }")}})}for(;[...b.querySelectorAll("case")].length>0;){const e=[...b.querySelectorAll("case")];e.forEach(e=>{const t=[...e.querySelectorAll("case")];if(!t.length>0){const t=e.hasAttribute("break")?"break;":"";t&&e.removeAttribute("break");const r=e.innerHTML,o=[...e.attributes][0]?[...e.attributes][0].nodeValue:"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let l=e.outerHTML;0===r.length?e.outerHTML=l.replace("<case>",`case ${o}:`).replace("</case>"," "+t):e.outerHTML=l.replace("<case>",`case ${o}: return \``).replace("</case>","`; "+t)}})}for(;[...b.querySelectorAll("default")].length>0;){const e=[...b.querySelectorAll("default")];e.forEach(e=>{const t=[...e.querySelectorAll("default")];if(!t.length>0){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let t=e.outerHTML;e.outerHTML=t.replace("<default>","default: return `").replace("</default>","`;")}})}for(;[...b.querySelectorAll("script[update], script[render], script[props]")].length>0;){const e=[...b.querySelectorAll("script[update], script[render], script[props]")];e.forEach(e=>{const t=e.attributes[0].name;for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let r=e.outerHTML;"update"===t?r=r.replace("<script>","${/*update*/ (() => {setTimeout(() => {").replace("</script>","}, 0); return ``})()}"):"props"===t?r=r.replace("<script>","${ /*props updates*/ (() => {$props = () => {").replace("</script>","};return ``})()}"):"render"===t&&(r=r.replace("<script>","${ /*render*/ (() => {").replace("</script>"," return ``})()}")),e.outerHTML=r,e.remove()})}let o="";const l=[...b.querySelectorAll("script")];l.forEach(e=>{e.attributes[0]?e.attributes[0].name.indexOf("mount")>-1&&(o+=`$bay['$mounted'] = () => {${e.innerText}};`,e.remove()):(o+=b.querySelector("script").innerText,e.remove())}),a=o,d=s}catch(e){console.error(e)}if(!u)return window.top.document.title="ðŸ”´"+w,void console.error("Somthing went wrong with loading the file "+w+".");customElements.define(u,class extends HTMLElement{constructor(){if(super(),this.mounted=!1,this.template=document.createElement("template"),this.original_template=`${b.innerHTML}`,this.uniqid=r(8),this.CSP_errors=!1,this.dsd=!1,this.debouncer=!1,this.blob_prefixes="",this.blob_event_prefixes="",this.shadowRoot){const e=[...this.shadowRoot.children],t=document.createElement("div");t.id="bay",e.map(e=>t.appendChild(e)),this.shadowRoot.appendChild(t),this.dsd=!0}else this.attachShadow({mode:"open"}),this.template.innerHTML='<div id="bay"></div>',this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.shadowRoot.querySelector("#bay").style.display="none";var e={get(t,r){if("isProxy"==r)return!0;const o=t[r];return void 0!==o&&null!=o?(o.isProxy||"object"!=typeof o||(t[r]=new Proxy(o,e)),t[r]):void 0},set:(e,r,o)=>void 0===o||(e[r]=t(o),this.render_debouncer(),!0)},l={};this.shadowRoot.proxy=new Proxy(l,e),window.bay[this.uniqid]=this.shadowRoot,[...s].forEach(e=>{this.shadowRoot.proxy[e.att]=e.value}),window.bay[this.uniqid][f]=this,this.oldEvents="",a||(a="/* No script tag found */"),this.shadowRoot.uniqid=this.uniqid;let n=this.getRootNode(),c="";n.host&&(c=`const $parent = window.bay['${n.host.uniqid}']['proxy'];\n`);const d=`const ${y} = window.bay['${this.uniqid}'];\n`,u=`const ${m} = window.bay.global;\n`,h=`const ${f} = ${y}['${f}'];\n`;this.local_update_evt=new CustomEvent(`bay_local_update_event_${this.uniqid}`);let p="";this.original_template.indexOf("/*props updates*/")>-1&&(p=`let $props;\nwindow.addEventListener(\`bay_local_update_event_${this.uniqid}\`, () => $props());\n`),window.bay.decode=(e=>{const t=document.createElement("textarea");return t.innerHTML=e,t.value});const w="$bay.decode = window.bay.decode;\n";this.blob_prefixes=`${d}${u}${h}${c}${w}${p}`,this.blob_event_prefixes=`${d}${u}${h}${c}${w}`;let g=`${this.blob_prefixes}`+o(a).replaceAll("this[",`${y}.proxy[`).replaceAll("this.",`${y}.proxy.`).replace(/(^[ \t]*\n)/gm,""),$=o(this.original_template).replaceAll("this[",`${y}.proxy[`).replaceAll("this.",`${y}.proxy.`).replace(/(^[ \t]*\n)/gm,""),A="";if(i&&(A=o(i).replaceAll('"${',"${").replaceAll("'${","${").replaceAll('}"',"}").replaceAll("}'","}").replaceAll("this[",`${y}.proxy[`).replaceAll("this.",`${y}.proxy.`).replaceAll("  ","").replaceAll("\n","")),this.add_JS_BlobFileToHead(`{"use strict";\n${g}\n${y}.template = () => { return \`${$}\`;};\n${y}.styles = () => { return \`${A}\`;};\n};`),this.hasAdoptedStyleSheets=!1,"adoptedStyleSheets"in document&&(this.hasAdoptedStyleSheets=!0),this.hasAdoptedStyleSheets)this.sheet=new CSSStyleSheet,this.sheet.replaceSync(A),this.shadowRoot.adoptedStyleSheets=[this.sheet];else{const e=new Blob([A],{type:"text/css"});let t=URL.createObjectURL(e),r=document.createElement("link");r.rel="stylesheet",r.href=t,this.shadowRoot.appendChild(r),r.id="bay-style";let o=document.createElement("link");o.id="bay-style-update",o.href=t,o.rel="stylesheet",this.shadowRoot.appendChild(o),this.styleLinkUpdate=o}}add_events_and_styles(e){let t="";[...e.querySelectorAll("*")].forEach((e,r)=>{const o=e.attributes;[...o].forEach(o=>{let l=":"===o.name.substring(0,1);if(l)if(o.name.indexOf(":style")>-1){let t={},r=o.value.split(";")||[o.value];r.map(e=>{let r=e.split(":");r[0]&&r[1]&&(t[r[0].trim()]=r[1].trim())}),Object.assign(e.style,t)}else{let l=o.value.replaceAll("window.bay",`${y}`);-1===t.indexOf(`${y}['${r}'] = {};`)&&(t+=`${y}['${r}'] = {};`),t+=`${y}['${r}']['${o.name}'] = function(e) {${l}};\n`,e[`on${o.name.split(":")[1]}`]=(e=>{window.bay[this.uniqid][`${r}`]&&window.bay[this.uniqid][`${r}`][`${o.name}`]&&window.bay[this.uniqid][`${r}`][o.name](e)})}})}),t&&this.oldEvents!==t&&(this.oldEvents=t,this.add_JS_Blob_event(t))}set_styles(){const e=window.bay[this.uniqid].styles();if(this.oldStyles!==e)if(this.oldStyles=e,this.hasAdoptedStyleSheets)this.sheet.replaceSync(e);else{var t=new Blob([e],{type:"text/css"}),r=URL.createObjectURL(t);this.styleLinkUpdate.href=r,URL.revokeObjectURL(r)}}render_debouncer(){this.debouncer&&window.cancelAnimationFrame(this.debouncer),this.debouncer=window.requestAnimationFrame(()=>{this.render()})}render(){if(this.CSP_errors)this.shadowRoot.innerHTML="";else if(this.original_template&&this.shadowRoot.querySelector("#bay").innerHTML&&"function"==typeof window.bay[this.uniqid].template)try{const e=c(window.bay[this.uniqid].template()),t=this.shadowRoot.querySelector("#bay");h(e,t);const r=[...e.querySelectorAll("*")],o=[...t.querySelectorAll("*")];r.forEach((e,t)=>{const r=o[t].isEqualNode(e);r||o[t]&&p(e,o[t])}),this.add_events_and_styles(t),this.set_styles(),!1===this.mounted&&window.bay[this.uniqid].$mounted&&(this.mounted=!0,setTimeout(()=>{window.bay[this.uniqid].$mounted()},14)),this.shadowRoot.querySelector("[bay]")&&l(this.shadowRoot)}catch(e){console.error(e)}}add_JS_Blob_event(e){const t=`{"use strict";\n${this.blob_event_prefixes}${e}};`,r=new Blob([t],{type:"text/javascript"}),o=URL.createObjectURL(r),l=document.createElement("script");l.type="text/javascript",l.src=o,this.shadowRoot.appendChild(l),l.onload=(()=>{URL.revokeObjectURL(o),l.remove()})}add_JS_BlobFileToHead(e){document.addEventListener("securitypolicyviolation",e=>{e.preventDefault(),e.violatedDirective.indexOf("script-src")>-1&&"blob"===e.blockedURI&&(console.warn("blob: needed in script-src CSP"),this.CSP_errors=!0),e.violatedDirective.indexOf("style-src")>-1&&"blob"===e.blockedURI&&(console.warn("blob: needed in style-src CSP"),this.CSP_errors=!0)});const t=new Blob([e],{type:"text/javascript"}),r=URL.createObjectURL(t),o=document.createElement("script");o.type="text/javascript",o.src=r,this.shadowRoot.appendChild(o),o.onload=(()=>{URL.revokeObjectURL(r),this.dsd||(this.original_template=window.bay[this.uniqid].template(),this.shadowRoot.getElementById("bay").innerHTML=this.original_template),this.render_debouncer(),o.remove(),this.CSP_errors?this.shadowRoot.innerHTML="CSP issue, add blob: to script-src & style-src whitelist.":(this.shadowRoot.getElementById("bay").style.display="",this.shadowRoot.querySelector("[bay]")&&l(this.shadowRoot))})}connectedCallback(){try{g&&window.addEventListener("bay_global_event",e=>{this.render_debouncer()})}catch(e){console.error(e)}}static get observedAttributes(){return d}attributeChangedCallback(e,t,r){t!==r&&(this.shadowRoot.proxy[e]=r,window.dispatchEvent(this.local_update_evt))}})}(function e(t){t.querySelectorAll("template[shadowroot]").forEach(t=>{const r=t.getAttribute("shadowroot"),o=t.parentNode.attachShadow({mode:r});o.appendChild(t.content),t.remove(),e(o)})})(document),window.bay={};const y="$bay",m="$global",f="$el";let w="",g=[],$=[];const A=document.createElement("textarea");if(!window.bay.global){const r={},o={get(e,t){if("isProxy"==t)return!0;const r=e[t];return void 0!==r&&null!=r?(r.isProxy||"object"!=typeof r||(e[t]=new Proxy(r,o)),e[t]):void 0},set:(r,o,l)=>(r[o]=t(l),e(),!0)};window.bay.global=new Proxy(r,o)}window.onload=(()=>{l(document)}),bay.refresh=(()=>{l(document)}),bay.create=s};"undefined"!=typeof exports?exports.default=bay:bay();