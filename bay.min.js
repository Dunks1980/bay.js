const bay=()=>{"use strict";function e(){const e=new CustomEvent("bay_global_event");window.dispatchEvent(e)}function t(e){return"string"==typeof e?(x.textContent=e,x.innerHTML.replaceAll('"',"&quot;").replaceAll("'","&#39;")):e}function n(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function o(e){if("function"==typeof crypto.randomUUID)return crypto.randomUUID().replaceAll("-","").substring(0,e);{let t=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16));return t().replaceAll("-","").substring(0,e)}}function r(e){const t=[...w(e,"[bay]")];t.forEach((e,t)=>{"dsd"===e.getAttribute("bay")&&e.setAttribute("bay",`dsd-${t}`);let n=e.getAttribute("bay");-1===v.indexOf(n)&&v.push(e)}),v.forEach(e=>{-1===L.indexOf(e.getAttribute("bay"))&&a(e),L.push(e.getAttribute("bay"))})}function i(e,t){const n=new DOMParser;let o,r,i=t.tagName.toLowerCase(),s="export default /*HTML*/`";e.startsWith(s)&&(e=e.trim(),e=e.split(s)[1],e=e.substring(0,e.length-2),e=e.replaceAll("\\${","${").replaceAll("\\`","`")),e.indexOf("<style>")>-1&&(r=e.split("<style>")[1].split("</style>")[0]),e=e.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${r}</style>`,""),o=n.parseFromString(e,"text/html"),o&&(customElements.get(i)||m(o,i,l(t),r))}function s(e,t,n){const o=new DOMParser;let r,i,s=n||[];t.indexOf("<style>")>-1&&(i=t.split("<style>")[1].split("</style>")[0]),t=t.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${i}</style>`,""),r=o.parseFromString(t,"text/html"),r&&(customElements.get(e.toLowerCase())||m(r,e.toLowerCase(),s,i))}function a(e){try{const t=e.getAttribute("bay");if("dsd-"===t.substring(0,4))g=t,e.shadowRoot?i(n(e.shadowRoot.innerHTML),e):i(n(e.querySelector("template").innerHTML),e);else if("#"===t.substring(0,1)){g=t;const n=document.querySelector(t);if(!n)return void console.error(`Bay cannot find "${t}" selector.`);i(n.innerHTML,e)}else{const n=new XMLHttpRequest;n.open("GET",t),n.setRequestHeader("Content-Type","text/plain"),n.addEventListener("load",t=>{i(t.target.responseText,e)}),n.addEventListener("error",e=>{console.error(e)}),n.send()}}catch(e){console.error(e)}}function l(e){let t=[];const n=e=>{"bay"!==e.name&&"inner-html"!==e.name&&"fouc"!==e.name&&-1===t.indexOf(e.name)&&t.push(e.name)};return[...e.attributes].forEach(e=>n(e)),[...w(document,e.tagName.toLocaleLowerCase())].forEach(e=>{const t=[...e.attributes];t.forEach(e=>n(e))}),[...w(document,"template")].forEach(t=>{[...w(t.content,e.tagName.toLocaleLowerCase())].forEach(e=>{const t=[...e.attributes];t.forEach(e=>n(e))})}),t}function d(e){const t=new DOMParser,n=t.parseFromString(e,"text/html");return n.body}function c(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()}function h(e){return e.childNodes&&e.childNodes.length>0?null:e.textContent}function u(e,t){const n=[...t.childNodes],o=[...e.childNodes];let r=n.length-o.length;if(r>0)for(;r>0;r--)n[n.length-r].parentNode.removeChild(n[n.length-r]);o.forEach((e,o)=>{if(!n[o])return void t.appendChild(e.cloneNode(!0));if(c(e)!==c(n[o])){try{n[o].parentNode.replaceChild(e.cloneNode(!0),n[o])}catch(e){}return}const r=h(e);if(r&&r!==h(n[o])&&(n[o].textContent=r),n[o].childNodes.length>0&&e.childNodes.length<1)n[o].innerHTML="";else{if(n[o].childNodes.length<1&&e.childNodes.length>0){const t=document.createDocumentFragment();return u(e,t),void n[o].appendChild(t)}e.childNodes.length>0&&u(e,n[o])}})}function p(e,t){return void 0!==e[t]&&"object"!=typeof e[t]}function b(e,t){[...t.attributes].forEach(n=>{e.hasAttribute(n.name)||(t.removeAttribute(n.nodeName),p(t,n.nodeName)&&delete t[n.nodeName])}),[...e.attributes].forEach(e=>{t.hasAttribute(e.nodeName)&&t.getAttribute(e.nodeName)===e.value||t.setAttribute(e.nodeName,e.value),p(t,e.nodeName)&&t[e.nodeName]!==e.value&&(t[e.nodeName]=e.value)})}function y(e){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name)}function m(e,i,s,a){let l,c,h="",p="",m=!1,v=!1;try{let t="*:not(:defined){opacity:0;max-width:0px;max-height:0px;}*:not(:defined)*{opacity:0;max-width:0px;max-height:0px;}";a=t+a,p=e.body,h=i;const n=document.createElement(`${i}-update`);p.appendChild(n),(p.innerHTML.indexOf("$global.")>-1||p.innerHTML.indexOf("$global[")>-1)&&(m=!0);let r=["dsd","noscript","map","for","if","else-if","else","switch","case","default","inner-html","script"],d="element, index, array",u="";r.forEach(e=>{for(;[...w(p,e)].length>0;){const t=[...w(p,e)];t.forEach(t=>{const n=t.querySelector(e);if(!n){const n=t.getAttribute("array")||[],r=t.getAttribute("params")||d,i=t.getAttribute("join")||"",s=[...t.attributes][0]?[...t.attributes][0].nodeValue:"",a=t.nextElementSibling?t.nextElementSibling.tagName.toLowerCase():"";let l="` } return '' })() }";const c=t.hasAttribute("break")?"break;":"",h=0===t.innerHTML.length,b=t.attributes.length?t.attributes[0].name:"",m=`<${e}>`,w=`</${e}>`;y(t);let $=t.outerHTML;switch(e){case"dsd":t.remove();break;case"noscript":p.innerHTML=p.innerHTML.replaceAll(m,"").replaceAll(w,"");break;case"map":$=$.replace(m,`\${ ${n}.${e}((${r}) => { return \``).replace(w,`\`}).join('${i}')}`),t.outerHTML=$;break;case"for":const d=`bay_${e}_${o(8)}`;$=n.length?$.replace(m,`\${(() => { let ${d} = ''; ${n}.forEach((${r}) => { ${d} += \``).replace(w,`\`}); return ${d}; })() }`):$.replace(m,`\${(() => { let ${d} = ''; ${e} (${s}) { ${d} += \``).replace(w,`\`}; return ${d}; })() }`),t.outerHTML=$;break;case"if":"else-if"!==a&&"else"!==a||(l="` }"),t.outerHTML=$.replace(m,`\${(() => { ${e} (${s}) { return \``).replace(w,l);break;case"else-if":"else-if"!==a&&"else"!==a||(l="` }"),t.outerHTML=$.replace(m,` else if (${s}) { return \``).replace(w,l);break;case"else":t.outerHTML=$.replace(m,` ${e} { return \``).replace(w,l);break;case"switch":t.outerHTML=$.replace(m,`\${(() => { ${e} (${s}) { `).replace(w," }; return '' })() }");break;case"case":t.outerHTML=h?$.replace(m,`${e} ${s}:`).replace(w," "+c):$.replace(m,`${e} ${s}: return \``).replace(w,"`; "+c);break;case"default":t.outerHTML=$.replace(m,`${e}: return \``).replace(w,"`;");break;case"inner-html":v=!0,t.outerHTML=$.replace(m,"${ (() => { $bay_inner_html += `").replace(w,"`; return ''} )()}"),t.remove();break;case"script":switch(b){case"update":$=$.replace(m,"${/*update*/ (() => {setTimeout(() => {").replace(w,"}, 0); return ``})()}");break;case"props":$=$.replace(m,"${ /*props updates*/ (() => {$props = () => {").replace(w,"};return ``})()}");break;case"render":$=$.replace(m,"${ /*render*/ (() => {").replace(w," return ``})()}");break;case"slotchange":$=$.replace(m,"${ /*slotchange updates*/ (() => {$slotchange = (e) => { $details = e.detail;\n").replace(w,"};return ``})()}");break;case"mounted":u+=`$bay['$mounted'] = () => {${t.innerText}};`,t.remove();break;default:u+=p.querySelector(e).innerText,t.remove()}t&&t.parentNode&&(t.outerHTML=$,t.remove())}}})}}),l=u,c=s}catch(e){console.error(e)}if(!h)return window.top.document.title="ðŸ”´"+g,void console.error("Something went wrong loading file "+g+".");customElements.define(h,class extends HTMLElement{constructor(){super(),this.mounted=!1,this.original_template=`${p.innerHTML}`,this.uniqid=o(8),this.CSP_errors=!1,this.dsd=!1,this.debouncer=!1,this.blob_prefixes="",this.blob_event_prefixes="";const e=this.getAttribute("inner-html");if(e?document.querySelector(e)?this.inner_html_target=document.querySelector(e):console.error("inner-html target "+e+" not found."):this.inner_html_target=this,document.addEventListener("securitypolicyviolation",e=>{e.preventDefault(),e.violatedDirective.indexOf("script-src")>-1&&"blob"===e.blockedURI&&(console.warn("blob: needed in script-src CSP"),this.CSP_errors=!0),e.violatedDirective.indexOf("style-src")>-1&&"blob"===e.blockedURI&&(console.warn("blob: needed in style-src CSP"),this.CSP_errors=!0)}),this.shadowRoot){const e=[...this.shadowRoot.children],t=document.createElement("div");t.id="bay",e.map(e=>t.appendChild(e)),this.shadowRoot.appendChild(t),this.dsd=!0}else{this.attachShadow({mode:"open"});let e=document.createElement("template");e.innerHTML='<div id="bay"></div>',this.shadowRoot.appendChild(e.content.cloneNode(!0))}var r={get(e,t){if("isProxy"==t)return!0;const n=e[t];return void 0!==n&&null!=n?(n.isProxy||"object"!=typeof n||(e[t]=new Proxy(n,r)),e[t]):void 0},set:(e,n,o)=>void 0===o||(e[n]=t(o),this.render_debouncer(),!0)},i={};this.shadowRoot.proxy=new Proxy(i,r),this.shadowRootHTML=this.shadowRoot.querySelector("#bay"),window.bay[this.uniqid]=this.shadowRoot,[...s].forEach(e=>{this.shadowRoot.proxy[e.att]=e.value}),window.bay[this.uniqid][_]=this,this.oldEvents="",l||(l="/* No script tag found */"),this.shadowRoot.uniqid=this.uniqid;let d=this.getRootNode(),c="";d.host&&(c=`const $parent = window.bay['${d.host.uniqid}']['proxy'];\n`);const h=`const ${$} = window.bay['${this.uniqid}'];\n`,u=`const ${f} = window.bay.global;\n`,b=`const ${_} = ${$}['${_}'];\n`;this.local_update_evt=new CustomEvent(`bay_local_update_event_${this.uniqid}`);let y="";this.original_template.indexOf("/*props updates*/")>-1&&(y=`let $props;\nwindow.addEventListener(\`bay_local_update_event_${this.uniqid}\`, () => $props());\n`);let m="";this.original_template.indexOf("/*slotchange updates*/")>-1&&(y=`let $slotchange = () => {};\nlet $details = {'element': '', 'changed': ''};\nwindow.addEventListener(\`bay_slotchange_event_${this.uniqid}\`, (e) => $slotchange(e));\n`),window.bay.decode=n;const g="$bay.decode = bay.decode;\n";window.bay.encode=t;const L="$bay.encode = bay.encode;\n";window.bay[this.uniqid].addEventListener("slotchange",e=>{this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e.target,changed:"slotchange"}}),window.dispatchEvent(this.local_slotchange_evt)});let x=w(this,"*");x.forEach(e=>{const t=new MutationObserver(t=>{t.forEach(t=>{"attributes"===t.type?(this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e,changed:"attributes"}}),window.dispatchEvent(this.local_slotchange_evt)):"childList"===t.type&&(this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e,changed:"childList"}}),window.dispatchEvent(this.local_slotchange_evt))})});t.observe(e,{attributes:!0,childList:!0})});let E="",A="",S="";v&&(E="let $bay_inner_html = '';\n",A=" $bay_inner_html = ''; ",S="\n$bay.inner_html = () => { return $bay_inner_html; };"),this.blob_prefixes=`${h}${u}${b}${c}${E}${L}${g}${y}${m}`,this.blob_event_prefixes=`${h}${u}${b}${c}${L}${g}`;let T=`${this.blob_prefixes}`+n(l).replaceAll("this[",`${$}.proxy[`).replaceAll("this.",`${$}.proxy.`).replace(/(^[ \t]*\n)/gm,""),R=n(this.original_template).replaceAll("this[",`${$}.proxy[`).replaceAll("this.",`${$}.proxy.`).replace(/(^[ \t]*\n)/gm,""),M="";if(a&&(M=n(a).replaceAll('"${',"${").replaceAll("'${","${").replaceAll('}"',"}").replaceAll("}'","}").replaceAll("this[",`${$}.proxy[`).replaceAll("this.",`${$}.proxy.`).replaceAll("  ","").replaceAll("\n","")),this.add_JS_BlobFileToHead(`${T}\n${$}.template = () => {${A}return \`${R}\`;};\n${$}.styles = () => { return \`${M}\`;};${S}`),this.hasAdoptedStyleSheets=!1,"adoptedStyleSheets"in document&&(this.hasAdoptedStyleSheets=!0),this.hasAdoptedStyleSheets)this.sheet=new CSSStyleSheet,this.sheet.replaceSync(M),this.shadowRoot.adoptedStyleSheets=[this.sheet];else{const e=new Blob([M],{type:"text/css"});let t=URL.createObjectURL(e),n=document.createElement("link");n.rel="stylesheet",n.href=t,this.shadowRoot.appendChild(n),n.id="bay-style";let o=document.createElement("link");o.id="bay-style-update",o.href=t,o.rel="stylesheet",this.shadowRoot.appendChild(o),this.styleLinkUpdate=o}}add_events_and_styles(e,t){if(!e)return;let n="";e.forEach((e,t)=>{const o=e.attributes;[...o].forEach(o=>{let r=":"===o.name.substring(0,1);if(r)if(o.name.indexOf(":style")>-1){let t={},n=o.value.split(";")||[o.value];n.map(e=>{let n=e.split(":");n[0]&&n[1]&&(t[n[0].trim()]=n[1].trim())}),Object.assign(e.style,t)}else{let r=o.value.replaceAll("window.bay",`${$}`);-1===n.indexOf(`${$}['${t}'] = {};`)&&(n+=`${$}['${t}'] = {};`),n+=`${$}['${t}']['${o.name}'] = function(e) {${r}};\n`,e[`on${o.name.split(":")[1]}`]=(e=>{window.bay[this.uniqid][`${t}`]&&window.bay[this.uniqid][`${t}`][`${o.name}`]&&window.bay[this.uniqid][`${t}`][o.name](e)})}})}),n&&this.oldEvents!==n&&(this.oldEvents=n,this.add_JS_Blob_event(n))}set_styles(){const e=window.bay[this.uniqid].styles();if(this.oldStyles!==e)if(this.oldStyles=e,this.hasAdoptedStyleSheets)this.sheet.replaceSync(e);else{var t=new Blob([e],{type:"text/css"}),n=URL.createObjectURL(t);this.styleLinkUpdate.href=n,URL.revokeObjectURL(n)}}isEqual_fn(e,t){e.forEach((e,n)=>{const o=t[n].isEqualNode(e);!o&&t[n]&&b(e,t[n])})}render_innerHTML(e){if(!e)return;if("function"!=typeof window.bay[this.uniqid].inner_html)return;window.bay[this.uniqid].template();const t=d(window.bay[this.uniqid].inner_html());u(t,e);const n=[...w(e,"*")],o=[...w(t,"*")];this.isEqual_fn(o,n)}render_shadowDOM(){const e=d(window.bay[this.uniqid].template());u(e,this.shadowRootHTML);const t=[...w(e,"*")],n=[...w(this.shadowRootHTML,"*")];this.isEqual_fn(t,n)}render_debouncer(){this.debouncer&&window.cancelAnimationFrame(this.debouncer),this.debouncer=window.requestAnimationFrame(()=>{this.render()})}render(){if(this.CSP_errors)this.shadowRoot.innerHTML="";else if(this.original_template&&this.shadowRootHTML.innerHTML&&"function"==typeof window.bay[this.uniqid].template)try{v&&this.render_innerHTML(this.inner_html_target),this.render_shadowDOM(),v?this.add_events_and_styles([...w(this.inner_html_target,"*"),...w(this.shadowRootHTML,"*")]):this.add_events_and_styles([...w(this.shadowRootHTML,"*")]),this.set_styles(),!1===this.mounted&&window.bay[this.uniqid].$mounted&&(this.mounted=!0,setTimeout(()=>{window.bay[this.uniqid].$mounted()},14)),this.shadowRoot.querySelector("[bay]")&&r(this.shadowRoot),this.hasAttribute("fouc")&&this.removeAttribute("fouc")}catch(e){console.error(e)}}async add_JS_Blob_event(e){const t=new Blob([`export default () => {"use strict";\n${this.blob_event_prefixes}${e}};`],{type:"text/javascript"}),n=URL.createObjectURL(t),o=await import(n);o.default(),URL.revokeObjectURL(n)}async add_JS_BlobFileToHead(e){const t=new Blob([`export default () => {"use strict";\n${e}};`],{type:"text/javascript"}),n=URL.createObjectURL(t),o=await import(n);o.default(),URL.revokeObjectURL(n),this.dsd||(this.original_template=window.bay[this.uniqid].template(),this.shadowRoot.getElementById("bay").innerHTML=this.original_template),this.render_debouncer(),this.CSP_errors?this.shadowRoot.innerHTML="CSP issue, add blob: to script-src & style-src whitelist.":this.shadowRoot.querySelector("[bay]")&&r(this.shadowRoot)}connectedCallback(){try{m&&window.addEventListener("bay_global_event",e=>{this.render_debouncer()})}catch(e){console.error(e)}}static get observedAttributes(){return c}attributeChangedCallback(e,t,n){t!==n&&(this.shadowRoot.proxy[e]=n,window.dispatchEvent(this.local_update_evt))}})}let w=(e,t)=>e.querySelectorAll(t);const $="$bay",f="$global",_="$el";window.bay={};let g="",v=[],L=[];(function e(t){w(t,"template[shadowroot]").forEach(t=>{const n=t.getAttribute("shadowroot"),o=t.parentNode.attachShadow({mode:n});o.appendChild(t.content),t.remove(),e(o)})})(document);const x=document.createElement("textarea");if(!window.bay.global){const n={},o={get(e,t){if("isProxy"==t)return!0;const n=e[t];return void 0!==n&&null!=n?(n.isProxy||"object"!=typeof n||(e[t]=new Proxy(n,o)),e[t]):void 0},set:(n,o,r)=>(n[o]=t(r),e(),!0)};window.bay.global=new Proxy(n,o)}window.onload=(()=>{r(document)}),bay.refresh=(()=>{r(document)}),bay.create=s};bay();