let bay=()=>{"use strict";function e(e,t){let r=new CustomEvent("bay_global_event",{detail:{key:e,value:t}});window.dispatchEvent(r)}function t(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=r.length,o=0;o<e;o++)t+=r.charAt(Math.floor(Math.random()*l));return t}function r(e){let t=[...e.querySelectorAll("[bay]")];t.forEach(e=>{let t=e.getAttribute("bay");-1===d.indexOf(t)&&d.push(e)}),d.forEach(e=>{-1===c.indexOf(e.getAttribute("bay"))&&o(e),c.push(e.getAttribute("bay"))})}function l(e,t){var r;let l;e.indexOf("<style>")>-1&&(l=e.split("<style>")[1].split("</style>")[0]),e=e.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${l}</style>`,"");var o=new DOMParser;r=o.parseFromString(e,"text/html"),r&&(customElements.get(t.tagName.toLowerCase())||s(r,t.tagName.toLowerCase(),i(t),l))}function o(e){try{let r=e.getAttribute("bay");if("#"===r.substring(0,1)){n=r;let t=document.querySelector(r);if(!t)return void console.error(`bay: "${r}" no element found with this selector.`);l(t.innerHTML,e)}else{var t=new XMLHttpRequest;t.open("GET",r),t.setRequestHeader("Content-Type","text/plain"),t.addEventListener("load",t=>{l(t.target.responseText,e)}),t.addEventListener("error",()=>{console.error("For CORS policy errors try this: https://stackoverflow.com/questions/10752055/cross-origin-requests-are-only-supported-for-http-error-when-loading-a-local")}),t.send()}}catch(e){console.error(e)}}function i(e){let t=[],r=[...e.attributes];return r.forEach(e=>{"bay"!==e.name&&-1===t.indexOf(e.name)&&t.push(e.name)}),t}function s(e,l,o,i){let s,d,c="",h="";try{h=e.body,c=l;let t=document.createElement("up-date");for(h.appendChild(t);[...h.querySelectorAll("map")].length>0;){let e=[...h.querySelectorAll("map")];e.forEach(e=>{let t=e.querySelector("map");if(!t){let t=e.getAttribute("array")||[],r=e.getAttribute("params")||"element, index, array",l=e.getAttribute("join")||"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let o=e.outerHTML;o=o.replace("<map>",`\${ ${t}.map((${r}) => { return \``).replace("</map>",`\`}).join('${l}')}`),e.outerHTML=o}})}for(;[...h.querySelectorAll("for")].length>0;){let e=[...h.querySelectorAll("for")];e.forEach(e=>{let t=e.querySelector("for");if(!t){let t=e.getAttribute("array")||[],r=e.getAttribute("params")||"element, index, array";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let l=e.outerHTML;l=l.replace("<for>",`\${(() => { let f = ''; ${t}.forEach((${r}) => { f += \``).replace("</for>","`}); return f; })() }"),e.outerHTML=l}})}for(;[...h.querySelectorAll("if")].length>0;){let e=[...h.querySelectorAll("if")];e.forEach(e=>{let t=[...e.querySelectorAll("if")];if(!t.length>0){let t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"",r=e.nextElementSibling?e.nextElementSibling.tagName.toLowerCase():"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let l=e.outerHTML,o="` } return '' })() }";"else-if"!==r&&"else"!==r||(o="` }"),e.outerHTML=l.replace("<if>",`\${(() => { if (${t}) { return \``).replace("</if>",o)}})}for(;[...h.querySelectorAll("else-if")].length>0;){let e=[...h.querySelectorAll("else-if")];e.forEach(e=>{let t=[...e.querySelectorAll("else-if")];if(!t.length>0){let t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"",r=e.nextElementSibling?e.nextElementSibling.tagName.toLowerCase():"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let l=e.outerHTML,o="` } return '' })() }";"else-if"!==r&&"else"!==r||(o="` }"),e.outerHTML=l.replace("<else-if>",` else if (${t}) { return \``).replace("</else-if>",o)}})}for(;[...h.querySelectorAll("else")].length>0;){let e=[...h.querySelectorAll("else")];e.forEach(e=>{let t=[...e.querySelectorAll("else")];if(!t.length>0){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let t=e.outerHTML;e.outerHTML=t.replace("<else>"," else { return `").replace("</else>","` } return '' })() }")}})}for(;[...h.querySelectorAll("script[update], script[render]")].length>0;){let e=[...h.querySelectorAll("script[update], script[render]")];e.forEach(e=>{let t=e.attributes[0].name;for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let r=e.outerHTML;"update"===t?r=r.replace("<script>","${/*update*/\n(() => { setTimeout(() => {").replace("</script>",'}, 0); return ""})()}'):"render"===t&&(r=r.replace("<script>","${/*render*/\n(() => {").replace("</script>","})()}")),e.outerHTML=r,e.remove()})}let r="",i=[...h.querySelectorAll("script")];i.forEach(e=>{e.attributes[0]?e.attributes[0].name.indexOf("mount")>-1&&(r+=`setTimeout(() => {${e.innerText}}, 0);`,e.remove()):(r+=h.querySelector("script").innerText,e.remove())}),s=r,d=o}catch(e){console.error(e)}if(!c)return window.top.document.title="ðŸ”´"+n,void console.error("Somthing went wrong with loading the file "+n+".");customElements.define(c,class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.template=document.createElement("template"),this.original_template="",this.uniqid=t(8),this.CSP_errors=!1;var e={get(t,r){if("isProxy"==r)return!0;const l=t[r];return void 0!==l&&null!=l?(l.isProxy||"object"!=typeof l||(t[r]=new Proxy(l,e)),t[r]):void 0},set:(e,t,r)=>(e[t]=r,this.render(),!0)},r={};this.shadowRoot.proxy=new Proxy(r,e),window.bay[this.uniqid]=this.shadowRoot,[...o].forEach(e=>{this.shadowRoot.proxy[e.att]=e.value}),this.original_template=`${h.innerHTML}`,this.template.innerHTML='<div id="bay"></div>',this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.shadowRoot.querySelector("#bay").style.display="none",this.oldEvents=""}stringToHTML(e){var t=new DOMParser,r=t.parseFromString(e,"text/html");return r.body}getNodeType(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()}getNodeContent(e){return e.childNodes&&e.childNodes.length>0?null:e.textContent}dom_diff(e,t){var r=Array.prototype.slice.call(t.childNodes),l=Array.prototype.slice.call(e.childNodes),o=r.length-l.length;if(o>0)for(;o>0;o--)r[r.length-o].parentNode.removeChild(r[r.length-o]);l.forEach((e,l)=>{if(r[l])if(this.getNodeType(e)===this.getNodeType(r[l])){var o=this.getNodeContent(e);if(o&&o!==this.getNodeContent(r[l])&&(r[l].textContent=o),r[l].childNodes.length>0&&e.childNodes.length<1)r[l].innerHTML="";else{if(r[l].childNodes.length<1&&e.childNodes.length>0){var i=document.createDocumentFragment();return this.dom_diff(e,i),void r[l].appendChild(i)}e.childNodes.length>0&&this.dom_diff(e,r[l])}}else try{r[l].parentNode.replaceChild(e.cloneNode(!0),r[l])}catch(e){}else t.appendChild(e.cloneNode(!0))})}copyAttributes(e,t){return[...e.attributes].forEach(e=>{"value"===e.nodeName?t.value=e.value:t.setAttribute(e.nodeName,e.nodeValue)})}add_events_and_styles(e){let t="";[...e.querySelectorAll("*")].forEach((e,r)=>{let l=e.attributes;[...l].forEach(l=>{let o=":"===l.name.substring(0,1);if(o)if(l.name.indexOf(":style")>-1){let t={},r=l.value.split(";")||[l.value];r.map(e=>{let r=e.split(":");t[r[0].trim()]=r[1].trim()}),Object.assign(e.style,t)}else{let o=l.value.replaceAll("window.bay","d");-1===t.indexOf(`d['${r}'] = {};`)&&(t+=`d['${r}'] = {};`),t+=`d['${r}']['${l.name}'] = function(e) {${o}};`,e[`on${l.name.split(":")[1]}`]=(e=>{window.bay[this.uniqid][`${r}`]&&window.bay[this.uniqid][`${r}`][`${l.name}`]&&window.bay[this.uniqid][`${r}`][l.name](e)})}})}),t&&this.oldEvents!==t&&(this.oldEvents=t,this.add_JS_Blob_event(t))}set_styles(){let e=window.bay[this.uniqid].styles();if(this.oldStyles!==e)if(this.oldStyles=e,this.hasAdoptedStyleSheets)this.sheet.replaceSync(e);else{var t=new Blob([e],{type:"text/css"}),r=URL.createObjectURL(t);this.styleLinkUpdate.href=r,URL.revokeObjectURL(r)}}render(){if(this.CSP_errors)this.shadowRoot.innerHTML="";else if(this.original_template&&this.shadowRoot.querySelector("#bay").innerHTML)try{var e=this.stringToHTML(window.bay[this.uniqid].template()),t=this.shadowRoot.querySelector("#bay");this.dom_diff(e,t);let l=[...e.querySelectorAll("*")],o=[...t.querySelectorAll("*")];l.forEach((e,t)=>{let r=o[t].isEqualNode(e);r||o[t]&&this.copyAttributes(e,o[t])}),this.add_events_and_styles(t),this.set_styles(),this.shadowRoot.querySelector("[bay]")&&r(this.shadowRoot)}catch(e){console.error(e)}}decodeHtml(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}add_JS_Blob_event(e){let t=`{"use strict";const d=window.bay['${this.uniqid}'];${e}};`;var r=new Blob([t],{type:"text/javascript"}),l=URL.createObjectURL(r),o=document.createElement("script");o.type="text/javascript",o.src=l,this.shadowRoot.appendChild(o),o.onload=(()=>{URL.revokeObjectURL(l),o.remove()})}add_JS_BlobFileToHead(e){var t=new Blob([e],{type:"text/javascript"}),l=URL.createObjectURL(t),o=document.createElement("script");o.type="text/javascript",o.src=l,this.shadowRoot.appendChild(o),o.onload=(()=>{URL.revokeObjectURL(l),this.original_template=window.bay[this.uniqid].template(),this.shadowRoot.getElementById("bay").innerHTML=this.original_template,this.render(),o.remove(),this.CSP_errors?this.shadowRoot.innerHTML="CSP issue, add blob: to script-src & style-src whitelist.":(this.shadowRoot.getElementById("bay").style.display="",this.shadowRoot.querySelector("[bay]")&&r(this.shadowRoot))})}connectedCallback(){s||(s="/* No script tag found */");try{let o=`const d = window.bay['${this.uniqid}'];\nconst dp = window.bay.global;`+this.decodeHtml(s).replaceAll(`${a}.`,"dp.").replaceAll("document.","d.").replaceAll("this[","d.proxy[").replaceAll("this.","d.proxy."),n=this.decodeHtml(this.original_template).replaceAll(`${a}.`,"dp.").replaceAll("document.","d.").replaceAll("this[","d.proxy[").replaceAll("this.","d.proxy."),d="";if(i&&(d=this.decodeHtml(i).replaceAll('"${',"${").replaceAll("'${","${").replaceAll('}"',"}").replaceAll("}'","}").replaceAll(`${a}.`,"dp.").replaceAll("document.","d.").replaceAll("this[","d.proxy[").replaceAll("this.","d.proxy.").replaceAll("  ","").replaceAll("\n","")),this.add_JS_BlobFileToHead(`{"use strict";\n${o}\nd.template = () => { return \`${n}\`;};\nd.styles = () => { return \`${d}\`;};\n};`),this.hasAdoptedStyleSheets=!1,"adoptedStyleSheets"in document&&(this.hasAdoptedStyleSheets=!0),this.hasAdoptedStyleSheets)this.sheet=new CSSStyleSheet,this.sheet.replaceSync(d),this.shadowRoot.adoptedStyleSheets=[this.sheet];else{var e=new Blob([d],{type:"text/css"}),t=URL.createObjectURL(e),r=document.createElement("link");r.rel="stylesheet",r.href=t,this.shadowRoot.appendChild(r),r.id="bay-style";var l=document.createElement("link");l.id="bay-style-update",l.href=t,l.rel="stylesheet",this.shadowRoot.appendChild(l),this.styleLinkUpdate=l}document.addEventListener("securitypolicyviolation",e=>{e.preventDefault(),e.violatedDirective.indexOf("script-src")>-1&&"blob"===e.blockedURI&&(console.warn("You need to allow blob: in your script-src CSP"),this.CSP_errors=!0),e.violatedDirective.indexOf("style-src")>-1&&"blob"===e.blockedURI&&(console.warn("You need to allow blob: in your script-src CSP, this is needed for browsers that dont support adoptedStyleSheets."),this.CSP_errors=!0)}),window.addEventListener("bay_global_event",e=>{this.render()})}catch(e){console.error(e)}}static get observedAttributes(){return d}attributeChangedCallback(e,t,r){t!==r&&(this.shadowRoot.proxy[e]=r)}})}window.bay={};let a="global",n="",d=[],c=[];if(!window.bay.global){var h={},u={get(e,t){if("isProxy"==t)return!0;const r=e[t];return void 0!==r&&null!=r?(r.isProxy||"object"!=typeof r||(e[t]=new Proxy(r,u)),e[t]):void 0},set:(t,r,l)=>(t[r]=l,e(),!0)};window.bay.global=new Proxy(h,u)}window.onload=(()=>{r(document)})};"undefined"!=typeof exports?exports.default=bay:bay();