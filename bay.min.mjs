const bay=()=>{"use strict";function e(){const e=new CustomEvent("bay_global_event");window.dispatchEvent(e)}function t(e){return"string"==typeof e?(A.textContent=e,A.innerHTML.replaceAll('"',"&quot;").replaceAll("'","&#39;")):e}function r(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function n(e){if("function"==typeof crypto.randomUUID)return crypto.randomUUID().replaceAll("-","").substring(0,e);{let t=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16));return t().replaceAll("-","").substring(0,e)}}function o(e){const t=[...e.querySelectorAll("[bay]")];t.forEach((e,t)=>{"dsd"===e.getAttribute("bay")&&e.setAttribute("bay",`dsd-${t}`);let r=e.getAttribute("bay");-1===$.indexOf(r)&&$.push(e)}),$.forEach(e=>{-1===_.indexOf(e.getAttribute("bay"))&&s(e),_.push(e.getAttribute("bay"))})}function l(e,t){const r=new DOMParser;let n,o,l=t.tagName.toLowerCase(),i="export default /*HTML*/`";e.startsWith(i)&&(e=e.trim(),e=e.split(i)[1],e=e.substring(0,e.length-2),e=e.replaceAll("\\${","${").replaceAll("\\`","`")),e.indexOf("<style>")>-1&&(o=e.split("<style>")[1].split("</style>")[0]),e=e.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${o}</style>`,""),n=r.parseFromString(e,"text/html"),n&&(customElements.get(l)||y(n,l,a(t),o))}function i(e,t,r){const n=new DOMParser;let o,l,i=r||[];t.indexOf("<style>")>-1&&(l=t.split("<style>")[1].split("</style>")[0]),t=t.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${l}</style>`,""),o=n.parseFromString(t,"text/html"),o&&(customElements.get(e.toLowerCase())||y(o,e.toLowerCase(),i,l))}function s(e){try{const t=e.getAttribute("bay");if("dsd-"===t.substring(0,4))g=t,e.shadowRoot?l(r(e.shadowRoot.innerHTML),e):l(r(e.querySelector("template").innerHTML),e);else if("#"===t.substring(0,1)){g=t;const r=document.querySelector(t);if(!r)return void console.error(`Bay cannot find "${t}" selector.`);l(r.innerHTML,e)}else{const r=new XMLHttpRequest;r.open("GET",t),r.setRequestHeader("Content-Type","text/plain"),r.addEventListener("load",t=>{l(t.target.responseText,e)}),r.addEventListener("error",e=>{console.error(e)}),r.send()}}catch(e){console.error(e)}}function a(e){let t=[];const r=[...e.attributes];return r.forEach(e=>{"bay"!==e.name&&"inner-html"!==e.name&&"fouc"!==e.name&&-1===t.indexOf(e.name)&&t.push(e.name)}),t}function c(e){const t=new DOMParser,r=t.parseFromString(e,"text/html");return r.body}function d(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()}function h(e){return e.childNodes&&e.childNodes.length>0?null:e.textContent}function u(e,t){const r=[...t.childNodes],n=[...e.childNodes];let o=r.length-n.length;if(o>0)for(;o>0;o--)r[r.length-o].parentNode.removeChild(r[r.length-o]);n.forEach((e,n)=>{if(!r[n])return void t.appendChild(e.cloneNode(!0));if(d(e)!==d(r[n])){try{r[n].parentNode.replaceChild(e.cloneNode(!0),r[n])}catch(e){}return}const o=h(e);if(o&&o!==h(r[n])&&(r[n].textContent=o),r[n].childNodes.length>0&&e.childNodes.length<1)r[n].innerHTML="";else{if(r[n].childNodes.length<1&&e.childNodes.length>0){const t=document.createDocumentFragment();return u(e,t),void r[n].appendChild(t)}e.childNodes.length>0&&u(e,r[n])}})}function p(e,t){return void 0!==e[t]&&"object"!=typeof e[t]}function b(e,t){[...t.attributes].forEach(r=>{e.hasAttribute(r.name)||(t.removeAttribute(r.nodeName),p(t,r.nodeName)&&delete t[r.nodeName])}),[...e.attributes].forEach(e=>{t.hasAttribute(e.nodeName)&&t.getAttribute(e.nodeName)===e.value||t.setAttribute(e.nodeName,e.value),p(t,e.nodeName)&&t[e.nodeName]!==e.value&&(t[e.nodeName]=e.value)})}function y(e,l,i,s){let a,d,h="",p="",y=!1,$=!1;try{let t="*:not(:defined){opacity:0;max-width:0px;max-height:0px;}*:not(:defined)*{opacity:0;max-width:0px;max-height:0px;}";s=t+s,p=e.body,h=l;const r=document.createElement(`${l}-update`);for(p.appendChild(r),(p.innerHTML.indexOf("$global.")>-1||p.innerHTML.indexOf("$global[")>-1)&&(y=!0);[...p.querySelectorAll("dsd")].length>0;){const e=[...p.querySelectorAll("dsd")];e.forEach(e=>{e.remove()})}for(p.innerHTML=p.innerHTML.replaceAll("<noscript>","").replaceAll("</noscript>","");[...p.querySelectorAll("map")].length>0;){const e=[...p.querySelectorAll("map")];e.forEach(e=>{const t=e.querySelector("map");if(!t){const t=e.getAttribute("array")||[],r=e.getAttribute("params")||"element, index, array",n=e.getAttribute("join")||"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let o=e.outerHTML;o=o.replace("<map>",`\${ ${t}.map((${r}) => { return \``).replace("</map>",`\`}).join('${n}')}`),e.outerHTML=o}})}for(;[...p.querySelectorAll("for")].length>0;){const e=[...p.querySelectorAll("for")];e.forEach(e=>{const t=e.querySelector("for");if(!t){const t=`bay_for_${n(8)}`;if(e.getAttribute("array")){const r=e.getAttribute("array")||[],n=e.getAttribute("params")||"element, index, array";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let o=e.outerHTML;o=o.replace("<for>",`\${(() => { let ${t} = ''; ${r}.forEach((${n}) => { ${t} += \``).replace("</for>",`\`}); return ${t}; })() }`),e.outerHTML=o}else{const r=[...e.attributes][0]?[...e.attributes][0].nodeValue:"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let n=e.outerHTML;n=n.replace("<for>",`\${(() => { let ${t} = ''; for (${r}) { ${t} += \``).replace("</for>",`\`}; return ${t}; })() }`),e.outerHTML=n}}})}for(;[...p.querySelectorAll("if")].length>0;){const e=[...p.querySelectorAll("if")];e.forEach(e=>{const t=[...e.querySelectorAll("if")];if(!t.length>0){const t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"",r=e.nextElementSibling?e.nextElementSibling.tagName.toLowerCase():"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let n=e.outerHTML,o="` } return '' })() }";"else-if"!==r&&"else"!==r||(o="` }"),e.outerHTML=n.replace("<if>",`\${(() => { if (${t}) { return \``).replace("</if>",o)}})}for(;[...p.querySelectorAll("else-if")].length>0;){const e=[...p.querySelectorAll("else-if")];e.forEach(e=>{const t=[...e.querySelectorAll("else-if")];if(!t.length>0){const t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"",r=e.nextElementSibling?e.nextElementSibling.tagName.toLowerCase():"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let n=e.outerHTML,o="` } return '' })() }";"else-if"!==r&&"else"!==r||(o="` }"),e.outerHTML=n.replace("<else-if>",` else if (${t}) { return \``).replace("</else-if>",o)}})}for(;[...p.querySelectorAll("else")].length>0;){const e=[...p.querySelectorAll("else")];e.forEach(e=>{const t=[...e.querySelectorAll("else")];if(!t.length>0){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let t=e.outerHTML;e.outerHTML=t.replace("<else>"," else { return `").replace("</else>","` } return '' })() }")}})}for(;[...p.querySelectorAll("switch")].length>0;){const e=[...p.querySelectorAll("switch")];e.forEach(e=>{const t=[...e.querySelectorAll("switch")];if(!t.length>0){const t=[...e.attributes][0]?[...e.attributes][0].nodeValue:"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let r=e.outerHTML;e.outerHTML=r.replace("<switch>",`\${(() => { switch (${t}) { `).replace("</switch>"," }; return '' })() }")}})}for(;[...p.querySelectorAll("case")].length>0;){const e=[...p.querySelectorAll("case")];e.forEach(e=>{const t=[...e.querySelectorAll("case")];if(!t.length>0){const t=e.hasAttribute("break")?"break;":"";t&&e.removeAttribute("break");const r=e.innerHTML,n=[...e.attributes][0]?[...e.attributes][0].nodeValue:"";for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let o=e.outerHTML;0===r.length?e.outerHTML=o.replace("<case>",`case ${n}:`).replace("</case>"," "+t):e.outerHTML=o.replace("<case>",`case ${n}: return \``).replace("</case>","`; "+t)}})}for(;[...p.querySelectorAll("default")].length>0;){const e=[...p.querySelectorAll("default")];e.forEach(e=>{const t=[...e.querySelectorAll("default")];if(!t.length>0){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let t=e.outerHTML;e.outerHTML=t.replace("<default>","default: return `").replace("</default>","`;")}})}for(;[...p.querySelectorAll("inner-html")].length>0;){$=!0;const e=[...p.querySelectorAll("inner-html")];e.forEach(e=>{for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let t=e.outerHTML;t=t.replace("<inner-html>","${ (() => { $bay_inner_html += `").replace("</inner-html>","`; return ''} )()}"),e.outerHTML=t,e.remove()})}for(;[...p.querySelectorAll("script[update], script[render], script[props], script[slotchange]")].length>0;){const e=[...p.querySelectorAll("script[update], script[render], script[props], script[slotchange]")];e.forEach(e=>{const t=e.attributes[0].name;for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);let r=e.outerHTML;switch(t){case"update":r=r.replace("<script>","${/*update*/ (() => {setTimeout(() => {").replace("</script>","}, 0); return ``})()}");break;case"props":r=r.replace("<script>","${ /*props updates*/ (() => {$props = () => {").replace("</script>","};return ``})()}");break;case"render":r=r.replace("<script>","${ /*render*/ (() => {").replace("</script>"," return ``})()}");break;case"slotchange":r=r.replace("<script>","${ /*slotchange updates*/ (() => {$slotchange = (e) => { $details = e.detail;\n").replace("</script>","};return ``})()}")}e.outerHTML=r,e.remove()})}let o="";const c=[...p.querySelectorAll("script")];c.forEach(e=>{e.attributes[0]?e.attributes[0].name.indexOf("mount")>-1&&(o+=`$bay['$mounted'] = () => {${e.innerText}};`,e.remove()):(o+=p.querySelector("script").innerText,e.remove())}),a=o,d=i}catch(e){console.error(e)}if(!h)return window.top.document.title="ðŸ”´"+g,void console.error("Something went wrong loading file "+g+".");customElements.define(h,class extends HTMLElement{constructor(){super(),this.mounted=!1,this.template=document.createElement("template"),this.original_template=`${p.innerHTML}`,this.uniqid=n(8),this.CSP_errors=!1,this.dsd=!1,this.debouncer=!1,this.blob_prefixes="",this.blob_event_prefixes="";const e=this.getAttribute("inner-html");if(e?document.querySelector(e)?this.inner_html_target=document.querySelector(e):console.error("inner-html target "+e+" not found."):this.inner_html_target=this,document.addEventListener("securitypolicyviolation",e=>{e.preventDefault(),e.violatedDirective.indexOf("script-src")>-1&&"blob"===e.blockedURI&&(console.warn("blob: needed in script-src CSP"),this.CSP_errors=!0),e.violatedDirective.indexOf("style-src")>-1&&"blob"===e.blockedURI&&(console.warn("blob: needed in style-src CSP"),this.CSP_errors=!0)}),this.shadowRoot){const e=[...this.shadowRoot.children],t=document.createElement("div");t.id="bay",e.map(e=>t.appendChild(e)),this.shadowRoot.appendChild(t),this.dsd=!0}else this.attachShadow({mode:"open"}),this.template.innerHTML='<div id="bay"></div>',this.shadowRoot.appendChild(this.template.content.cloneNode(!0));var o={get(e,t){if("isProxy"==t)return!0;const r=e[t];return void 0!==r&&null!=r?(r.isProxy||"object"!=typeof r||(e[t]=new Proxy(r,o)),e[t]):void 0},set:(e,r,n)=>void 0===n||(e[r]=t(n),this.render_debouncer(),!0)},l={};this.shadowRoot.proxy=new Proxy(l,o),this.shadowRootHTML=this.shadowRoot.querySelector("#bay"),window.bay[this.uniqid]=this.shadowRoot,[...i].forEach(e=>{this.shadowRoot.proxy[e.att]=e.value}),window.bay[this.uniqid][w]=this,this.oldEvents="",a||(a="/* No script tag found */"),this.shadowRoot.uniqid=this.uniqid;let c=this.getRootNode(),d="";c.host&&(d=`const $parent = window.bay['${c.host.uniqid}']['proxy'];\n`);const h=`const ${m} = window.bay['${this.uniqid}'];\n`,u=`const ${f} = window.bay.global;\n`,b=`const ${w} = ${m}['${w}'];\n`;this.local_update_evt=new CustomEvent(`bay_local_update_event_${this.uniqid}`);let y="";this.original_template.indexOf("/*props updates*/")>-1&&(y=`let $props;\nwindow.addEventListener(\`bay_local_update_event_${this.uniqid}\`, () => $props());\n`);let g="";this.original_template.indexOf("/*slotchange updates*/")>-1&&(y=`let $slotchange = () => {};\nlet $details = {'element': '', 'changed': ''};\nwindow.addEventListener(\`bay_slotchange_event_${this.uniqid}\`, (e) => $slotchange(e));\n`),window.bay.decode=r;const _="$bay.decode = bay.decode;\n";window.bay.encode=t;const A="$bay.encode = bay.encode;\n";window.bay[this.uniqid].addEventListener("slotchange",e=>{this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e.target,changed:"slotchange"}}),window.dispatchEvent(this.local_slotchange_evt)});let v=this.querySelectorAll("*");v.forEach(e=>{const t=new MutationObserver(t=>{t.forEach(t=>{"attributes"===t.type?(this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e,changed:"attributes"}}),window.dispatchEvent(this.local_slotchange_evt)):"childList"===t.type&&(this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e,changed:"childList"}}),window.dispatchEvent(this.local_slotchange_evt))})});t.observe(e,{attributes:!0,childList:!0})});let S="",q="",L="";$&&(S="let $bay_inner_html = '';\n",q=" $bay_inner_html = ''; ",L="\n$bay.inner_html = () => { return $bay_inner_html; };"),this.blob_prefixes=`${h}${u}${b}${d}${S}${A}${_}${y}${g}`,this.blob_event_prefixes=`${h}${u}${b}${d}${A}${_}`;let x=`${this.blob_prefixes}`+r(a).replaceAll("this[",`${m}.proxy[`).replaceAll("this.",`${m}.proxy.`).replace(/(^[ \t]*\n)/gm,""),E=r(this.original_template).replaceAll("this[",`${m}.proxy[`).replaceAll("this.",`${m}.proxy.`).replace(/(^[ \t]*\n)/gm,""),T="";if(s&&(T=r(s).replaceAll('"${',"${").replaceAll("'${","${").replaceAll('}"',"}").replaceAll("}'","}").replaceAll("this[",`${m}.proxy[`).replaceAll("this.",`${m}.proxy.`).replaceAll("  ","").replaceAll("\n","")),this.add_JS_BlobFileToHead(`${x}\n${m}.template = () => {${q}return \`${E}\`;};\n${m}.styles = () => { return \`${T}\`;};${L}`),this.hasAdoptedStyleSheets=!1,"adoptedStyleSheets"in document&&(this.hasAdoptedStyleSheets=!0),this.hasAdoptedStyleSheets)this.sheet=new CSSStyleSheet,this.sheet.replaceSync(T),this.shadowRoot.adoptedStyleSheets=[this.sheet];else{const e=new Blob([T],{type:"text/css"});let t=URL.createObjectURL(e),r=document.createElement("link");r.rel="stylesheet",r.href=t,this.shadowRoot.appendChild(r),r.id="bay-style";let n=document.createElement("link");n.id="bay-style-update",n.href=t,n.rel="stylesheet",this.shadowRoot.appendChild(n),this.styleLinkUpdate=n}}add_events_and_styles(e,t){if(!e)return;let r="";e.forEach((e,t)=>{const n=e.attributes;[...n].forEach(n=>{let o=":"===n.name.substring(0,1);if(o)if(n.name.indexOf(":style")>-1){let t={},r=n.value.split(";")||[n.value];r.map(e=>{let r=e.split(":");r[0]&&r[1]&&(t[r[0].trim()]=r[1].trim())}),Object.assign(e.style,t)}else{let o=n.value.replaceAll("window.bay",`${m}`);-1===r.indexOf(`${m}['${t}'] = {};`)&&(r+=`${m}['${t}'] = {};`),r+=`${m}['${t}']['${n.name}'] = function(e) {${o}};\n`,e[`on${n.name.split(":")[1]}`]=(e=>{window.bay[this.uniqid][`${t}`]&&window.bay[this.uniqid][`${t}`][`${n.name}`]&&window.bay[this.uniqid][`${t}`][n.name](e)})}})}),r&&this.oldEvents!==r&&(this.oldEvents=r,this.add_JS_Blob_event(r))}set_styles(){const e=window.bay[this.uniqid].styles();if(this.oldStyles!==e)if(this.oldStyles=e,this.hasAdoptedStyleSheets)this.sheet.replaceSync(e);else{var t=new Blob([e],{type:"text/css"}),r=URL.createObjectURL(t);this.styleLinkUpdate.href=r,URL.revokeObjectURL(r)}}isEqual_fn(e,t){e.forEach((e,r)=>{const n=t[r].isEqualNode(e);!n&&t[r]&&b(e,t[r])})}render_innerHTML(e){if(!e)return;if("function"!=typeof window.bay[this.uniqid].inner_html)return;window.bay[this.uniqid].template();const t=c(window.bay[this.uniqid].inner_html());u(t,e);const r=[...e.querySelectorAll("*")],n=[...t.querySelectorAll("*")];this.isEqual_fn(n,r)}render_shadowDOM(){const e=c(window.bay[this.uniqid].template());u(e,this.shadowRootHTML);const t=[...e.querySelectorAll("*")],r=[...this.shadowRootHTML.querySelectorAll("*")];this.isEqual_fn(t,r)}render_debouncer(){this.debouncer&&window.cancelAnimationFrame(this.debouncer),this.debouncer=window.requestAnimationFrame(()=>{this.render()})}render(){if(this.CSP_errors)this.shadowRoot.innerHTML="";else if(this.original_template&&this.shadowRootHTML.innerHTML&&"function"==typeof window.bay[this.uniqid].template)try{$&&this.render_innerHTML(this.inner_html_target),this.render_shadowDOM(),$?this.add_events_and_styles([...this.inner_html_target.querySelectorAll("*"),...this.shadowRootHTML.querySelectorAll("*")]):this.add_events_and_styles([...this.shadowRootHTML.querySelectorAll("*")]),this.set_styles(),!1===this.mounted&&window.bay[this.uniqid].$mounted&&(this.mounted=!0,setTimeout(()=>{window.bay[this.uniqid].$mounted()},14)),this.shadowRoot.querySelector("[bay]")&&o(this.shadowRoot),this.hasAttribute("fouc")&&this.removeAttribute("fouc")}catch(e){console.error(e)}}async add_JS_Blob_event(e){const t=new Blob([`export default () => {"use strict";\n${this.blob_event_prefixes}${e}};`],{type:"text/javascript"}),r=URL.createObjectURL(t),n=await import(r);n.default(),URL.revokeObjectURL(r)}async add_JS_BlobFileToHead(e){const t=new Blob([`export default () => {"use strict";\n${e}};`],{type:"text/javascript"}),r=URL.createObjectURL(t),n=await import(r);n.default(),URL.revokeObjectURL(r),this.dsd||(this.original_template=window.bay[this.uniqid].template(),this.shadowRoot.getElementById("bay").innerHTML=this.original_template),this.render_debouncer(),this.CSP_errors?this.shadowRoot.innerHTML="CSP issue, add blob: to script-src & style-src whitelist.":this.shadowRoot.querySelector("[bay]")&&o(this.shadowRoot)}connectedCallback(){try{y&&window.addEventListener("bay_global_event",e=>{this.render_debouncer()})}catch(e){console.error(e)}}static get observedAttributes(){return d}attributeChangedCallback(e,t,r){t!==r&&(this.shadowRoot.proxy[e]=r,window.dispatchEvent(this.local_update_evt))}})}const m="$bay",f="$global",w="$el";window.bay={};let g="",$=[],_=[];(function e(t){t.querySelectorAll("template[shadowroot]").forEach(t=>{const r=t.getAttribute("shadowroot"),n=t.parentNode.attachShadow({mode:r});n.appendChild(t.content),t.remove(),e(n)})})(document);const A=document.createElement("textarea");if(!window.bay.global){const r={},n={get(e,t){if("isProxy"==t)return!0;const r=e[t];return void 0!==r&&null!=r?(r.isProxy||"object"!=typeof r||(e[t]=new Proxy(r,n)),e[t]):void 0},set:(r,n,o)=>(r[n]=t(o),e(),!0)};window.bay.global=new Proxy(r,n)}window.onload=(()=>{o(document)}),bay.refresh=(()=>{o(document)}),bay.create=i};export default bay;