var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const bay=()=>{"use strict";const e=(e,t)=>e.querySelectorAll(t),t="data-bay-";window.bay={};let n="",i=[],a=[],o={};!function t(n){e(n,"template[shadowrootmode], template[shadowroot]").forEach((e=>{const n=e.getAttribute("shadowrootmode")||e.getAttribute("shadowroot"),i=e.parentNode.attachShadow({mode:n});i.appendChild(e.content),e.remove(),t(i)}))}(document);const r=document.createElement("textarea");function s(e){return"string"==typeof e?(r.textContent=e,r.innerHTML.replaceAll('"',"&quot;").replaceAll("'","&#39;")):e}function l(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function d(e,t){return new Proxy(e,{get(e,n){if("isProxy"==n)return!0;const i=e[n];return void 0!==i&&null!=i?(i.isProxy||"object"!=typeof i||(e[n]=d(i,t)),e[n]):void 0},set:(e,n,i)=>(e[n]=s(i),t&&t(),!0)})}let h,c;function u(){window.bay.route.href=window.location.href,window.bay.route.protocol=window.location.protocol,window.bay.route.host=window.location.host,window.bay.route.hostname=window.location.hostname,window.bay.route.port=window.location.port,window.bay.route.path=window.location.pathname,window.bay.route.search=window.location.search,window.bay.route.hash=window.location.hash,window.bay.route.params={};let e=new URLSearchParams(window.location.search);for(let[t,n]of e)window.bay.route.params[t]=n}function p(e){if("function"==typeof crypto.randomUUID)return crypto.randomUUID().replaceAll("-","").substring(0,e);return(()=>([1e7].toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))))().replaceAll("-","").substring(0,e)}window.bay.global=d({},(()=>{h&&window.cancelAnimationFrame(h),h=window.requestAnimationFrame((()=>{!function(){const e=new CustomEvent("bay_global_event");window.dispatchEvent(e)}()}))})),window.bay.route=d({},(()=>{c&&window.cancelAnimationFrame(c),c=window.requestAnimationFrame((()=>{!function(){const e=new CustomEvent("bay_route_event");window.dispatchEvent(e)}()}))})),u(),window.addEventListener("popstate",(()=>{u()})),window.bay.router=function(e,t){const n=t.split("/"),i=e.split("/");let a=!0,o={};for(let e=0;e<n.length;e++)if(":"===n[e][0])o[n[e].slice(1)]=i[e];else if("*"!==n[e]&&n[e]!==i[e]){a=!1;break}return!!a&&o};const b=p(8);function w(t){[...e(t,"[bay]")].forEach(((e,t)=>{"dsd"===e.getAttribute("bay")&&e.setAttribute("bay",`dsd-${t}`);let n=e.getAttribute("bay")||"";-1===i.indexOf(n)&&i.push(e)})),i.forEach((t=>{-1===a.indexOf(t.getAttribute("bay"))&&function(t){try{const i=t.getAttribute("bay")||"";if("dsd-"===i.substring(0,4))n=i,t.shadowRoot?y(l(t.shadowRoot.innerHTML),t):y(l(e(t,"template")[0].innerHTML),t);else if("#"===i.substring(0,1)){n=i;const a=e(document,i)[0];if(!a)return;y(a.innerHTML,t)}else{const e=new XMLHttpRequest;e.open("GET",i),e.setRequestHeader("Content-Type","text/plain"),e.addEventListener("load",(e=>{y(e.target.responseText,t)})),e.addEventListener("error",(e=>{})),e.send()}}catch(e){}}(t),a.push(t.getAttribute("bay"))}))}function y(t,n){const i=new DOMParser;let a,o="",r=n.tagName.toLowerCase(),s="export default /*HTML*/`";for(t.startsWith(s)&&(t=(t=(t=(t=t.trim()).split(s)[1]).substring(0,t.length-2)).replaceAll("\\${","${").replaceAll("\\`","`"));t.indexOf("<style>")>-1;){const e=t.split("<style>")[1].split("</style>")[0];t=t.replaceAll(`<style>${e}</style>`,""),o+=e}t=t.replaceAll(/<!--[\s\S]*?-->/g,""),a=i.parseFromString(t,"text/html"),a&&(customElements.get(r)||g(a,r,function(t){let n=[];const i=e=>{"bay"!==e.name&&"inner-html"!==e.name&&"fouc"!==e.name&&-1===n.indexOf(e.name)&&n.push(e.name)};return[...t.attributes].forEach((e=>i(e))),[...e(document,t.tagName.toLocaleLowerCase())].forEach((e=>{[...e.attributes].forEach((e=>i(e)))})),[...e(document,"template")].forEach((n=>{[...e(n.content,t.tagName.toLocaleLowerCase())].forEach((e=>{[...e.attributes].forEach((e=>i(e)))}))})),n}(n),o,!1))}function m(e){return(new DOMParser).parseFromString(e,"text/html").body}function f(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()}function $(e){return e.childNodes&&e.childNodes.length>0?null:e.textContent}function _(e,t){const n=[...t.childNodes],i=[...e.childNodes];let a=n.length-i.length;if(a>0)for(;a>0;a--)n[n.length-a].parentNode.removeChild(n[n.length-a]);i.forEach(((e,i)=>{if(!n[i])return void t.appendChild(e.cloneNode(!0));if(f(e)!==f(n[i])){try{n[i].parentNode.replaceChild(e.cloneNode(!0),n[i])}catch(e){}return}const a=$(e);if(a&&a!==$(n[i])&&(n[i].textContent=a),n[i].childNodes.length>0&&e.childNodes.length<1)n[i].innerHTML="";else{if(n[i].childNodes.length<1&&e.childNodes.length>0){const t=document.createDocumentFragment();return _(e,t),void n[i].appendChild(t)}e.childNodes.length>0&&_(e,n[i])}}))}function v(e,t){return void 0!==e[t]&&"object"!=typeof e[t]}function g(n,i,a,r,h){let c="",y=null,f="",$=[],g=!1,L=!1,E=!1;try{r="*:not(:defined){opacity:0;max-width:0px;max-height:0px}*:not(:defined)*{opacity:0;max-width:0px;max-height:0px}.bay-hide{display:none}"+(r||""),y=n.body,c=i;const t=document.createElement(`${i}-update`);y.appendChild(t),(y.innerHTML.indexOf("$global.")>-1||y.innerHTML.indexOf("$global[")>-1)&&(g=!0),(y.innerHTML.indexOf("$route.")>-1||y.innerHTML.indexOf("$route[")>-1||y.innerHTML.indexOf("</router>")>-1||y.innerHTML.indexOf("</route>")>-1||y.innerHTML.indexOf("$bay.update_route")>-1)&&(L=!0),y.innerHTML.indexOf("</route>")>-1&&(r=(r||"")+"[bay-route]>*{pointer-events:none}"),y.innerHTML.indexOf("</show>")>-1&&bay.create(`show-${b}`,"\n  <div id=\"show\" :style=\"${this.style()}\"><slot></slot></div>\n  <script update>$bay.getElementById('show').ontransitionend = () => this.end();<\/script>\n  <script props>this.slide(this.open);<\/script>\n  <script mounted>this.slide(this.open);<\/script>\n  <script>\n    this.opacity = 0;\n    this.display = 'none';\n    this.slide = (open) => {\n      let opacity = 0;\n      if (open === 'true') {opacity = 1; this.display = 'block';}\n      requestAnimationFrame(() => {this.opacity = opacity;});};\n    this.end = () => {if (this.open === 'false') { this.display = 'none';}}\n    this.style = () => {return `display:${this.display}; opacity:${this.opacity}; transition: opacity ${this.transition || '0s'};`;};\n  <\/script>\n",["open","transition"]);const o="element, index, array";let s="";const l=(t,n)=>{if(!e(t,n)[0]){const i=t.getAttribute("array")||[],a=t.getAttribute("params")||o,r=t.getAttribute("join")||"",l=t.getAttribute("duration")||!1,d=[...t.attributes][0]?[...t.attributes][0].nodeValue:"",h=t.nextElementSibling?t.nextElementSibling.tagName.toLowerCase():"";let c="` } return '' })() }";const u=t.hasAttribute("break")?"break;":"",w=0===t.innerHTML.length,m=t.attributes.length?t.attributes[0].name:"",f=`<${n}>`,$=`</${n}>`,_=[...t.attributes];!function(e){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name)}(t);let v=t.outerHTML;switch(n){case"dsd":t.remove();break;case"noscript":y.innerHTML=y.innerHTML.replaceAll(f,"").replaceAll($,"");break;case"map":v=v.replace(f,`\${ ${i}.${n}((${a}) => { return \``).replace($,`\`}).join('${r}')}`),t.outerHTML=v;break;case"for":const o=`bay_${n}_${p(8)}`;v=i.length?v.replace(f,`\${(() => { let ${o} = ''; ${i}.forEach((${a}) => { ${o} += \``).replace($,`\`}); return ${o}; })() }`):v.replace(f,`\${(() => { let ${o} = ''; ${n} (${d}) { ${o} += \``).replace($,`\`}; return ${o}; })() }`),t.outerHTML=v;break;case"if":"else-if"!==h&&"else"!==h||(c="` }"),t.outerHTML=v.replace(f,`\${(() => { ${n} (${d}) { return \``).replace($,c);break;case"else-if":"else-if"!==h&&"else"!==h||(c="` }"),t.outerHTML=v.replace(f,` else if (${d}) { return \``).replace($,c);break;case"else":t.outerHTML=v.replace(f,` ${n} { return \``).replace($,c);break;case"show":t.outerHTML=l?v.replace(f,`<show-${b} class="bay-show" open="\${${d}}" transition="${l} ease-in-out">`).replace($,`</show-${b}>`):v.replace(f,`<div class="\${(${d}) ? 'bay-show' : 'bay-show bay-hide'}">`).replace($,"</div>");break;case"switch":t.outerHTML=v.replace(f,`\${(() => { ${n} (${d}) { `).replace($," }; return '' })() }");break;case"case":t.outerHTML=w?v.replace(f,`${n} ${d}:`).replace($," "+u):v.replace(f,`${n} ${d}: return \``).replace($,"`; "+u);break;case"default":t.outerHTML=v.replace(f,`${n}: return \``).replace($,"`;");break;case"inner-html":E=!0,t.outerHTML=v.replace(f,"${ (() => { $bay_inner_html += `").replace($,"`; return ''} )()}"),t.remove();break;case"route":let g="";_.forEach((e=>{g+=` ${e.name}="${e.value}"`})),t.outerHTML=v.replace(f,`<a bay-route :click="e.preventDefault();history.pushState({},'',e.target.getAttribute('href'));window.bay.update_route();"${g}>`).replace($,"</a>");break;case"router":t.outerHTML=v.replace(f,`\${(() => { let $path = window.bay.router(window.bay.route.path,'${d}'); if ($path) { return \``).replace($,c);break;case"script":switch(m){case"update":v=v.replace(f,"${/*update*/ (() => {setTimeout(() => {").replace($,"}, 0); return ``})()}");break;case"props":v=v.replace(f,"${ /*props updates*/ (() => {$props = () => {").replace($,"};return ``})()}");break;case"render":v=v.replace(f,"${ /*render*/ (() => {").replace($," return ``})()}");break;case"slotchange":v=v.replace(f,"${ /*slotchange updates*/ (() => {$slotchange = (e) => { $details = e.detail;\n").replace($,"};return ``})()}");break;case"mounted":s+=`$bay['$mounted'] = () => {${t.innerText}};`,t.remove();break;default:const i=e(y,n)[0];s+=i.innerText,t.remove();break}t&&t.parentNode&&(t.outerHTML=v,t.remove());break}}};["dsd","noscript","map","for","if","else-if","else","show","switch","case","default","inner-html","route","router","script"].forEach((t=>{for(;[...e(y,t)].length>0;){[...e(y,t)].forEach((e=>l(e,t)))}})),[...e(y,"*")].forEach((e=>{[...e.attributes].forEach((t=>{if(":"===t.name.substring(0,1)){let n=t.name.split(":")[1];e.setAttribute(`data-bay-${n}`,t.value),e.removeAttribute(t.name)}}))})),f=s,$=a}catch(e){}c&&customElements.define(c,class extends HTMLElement{constructor(){super(),this.oldEventsArray=[],this.newEventsArray=[],this.mounted=!1,this.original_template=`${y.innerHTML}`,this.uniqid=p(8),this.CSP_errors=!1,this.dsd=!1,this.debouncer=!1,this.blob_prefixes="",this.blob_event_prefixes="";const t=this.getAttribute("inner-html");if(t?e(document,t)[0]&&(this.inner_html_target=e(document,t)[0]):this.inner_html_target=this,document.addEventListener("securitypolicyviolation",(e=>{e.preventDefault(),e.violatedDirective.indexOf("script-src")>-1&&"blob"===e.blockedURI&&(this.CSP_errors=!0),e.violatedDirective.indexOf("style-src")>-1&&"blob"===e.blockedURI&&(this.CSP_errors=!0)})),this.shadowRoot){this.shadowDom=this.shadowRoot;const e=[...this.shadowDom.children],t=document.createElement("div");t.id="bay",e.map((e=>t.appendChild(e))),this.shadowRoot.appendChild(t),this.dsd=!0}else{this.attachShadow({mode:"open"}),this.shadowDom=this.shadowRoot;let e=document.createElement("template");e.innerHTML='<div id="bay"></div>',this.shadowDom.appendChild(e.content.cloneNode(!0))}this.shadowDom.proxy=d({},(()=>{this.render_debouncer()})),this.shadowRootHTML=e(this.shadowDom,"#bay")[0],window.bay[this.uniqid]=this.shadowDom,[...a].forEach((e=>{this.shadowDom.proxy[e.att]=e.value})),window.bay[this.uniqid].$el=this,this.oldEvents="",this.oldEventsArray=[],f||(f="/* No script tag found */"),this.shadowDom.uniqid=this.uniqid;let n=this.getRootNode(),i="",o="",h="";n.host&&(i="const $parent = window.bay[parent_uniqid]['proxy'];\n",o=`const $parent = window.bay['${n.host.uniqid}']['proxy'];\n`,h=n.host.uniqid);const c=`const $bay = window.bay['${this.uniqid}'];\n`,b="const $global = window.bay.global;\n",w="const $route = window.bay.route;\n",m="const $el = $bay['$el'];\n";this.local_update_evt=new CustomEvent(`bay_local_update_event_${this.uniqid}`);let $="";this.original_template.indexOf("/*props updates*/")>-1&&($="let $props;\nwindow.addEventListener(`bay_local_update_event_${bay_uniqid}`, () => $props());\n");this.original_template.indexOf("/*slotchange updates*/")>-1&&($="let $slotchange = () => {};\nlet $details = {'element': '', 'changed': ''};\nwindow.addEventListener(`bay_slotchange_event_${bay_uniqid}`, (e) => $slotchange(e));\n"),window.bay.decode=l;const _="$bay.decode = window.bay.decode;\n";window.bay.encode=s;const v="$bay.encode = window.bay.encode;\n";window.bay.update_route=u;let g="";L&&(g="$bay.update_route = window.bay.update_route;\n"),window.bay[this.uniqid].addEventListener("slotchange",(e=>{this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e.target,changed:"slotchange"}}),window.dispatchEvent(this.local_slotchange_evt)})),e(this,"*").forEach((e=>{new MutationObserver((t=>{t.forEach((t=>{"attributes"===t.type?(this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e,changed:"attributes"}}),window.dispatchEvent(this.local_slotchange_evt)):"childList"===t.type&&(this.local_slotchange_evt=new CustomEvent(`bay_slotchange_event_${this.uniqid}`,{detail:{element:e,changed:"childList"}}),window.dispatchEvent(this.local_slotchange_evt))}))})).observe(e,{attributes:!0,childList:!0})}));let x="",A="",T="";E&&(x="let $bay_inner_html = '';\n",A=" $bay_inner_html = ''; ",T="\n$bay.inner_html = () => { return $bay_inner_html; };"),this.blob_prefixes=`const $bay = window.bay[bay_uniqid];\n${b}${w}${m}${i}${x}${v}${_}${$}${g}`,this.blob_event_prefixes=`${c}${b}${w}${m}${o}${v}${_}${g}`;let M=`${this.blob_prefixes}`+l(f).replaceAll("this[","$bay.proxy[").replaceAll("this.","$bay.proxy.").replace(/(^[ \t]*\n)/gm,""),H=l(this.original_template).replaceAll("this[","$bay.proxy[").replaceAll("this.","$bay.proxy.").replace(/(^[ \t]*\n)/gm,""),q="";if(r&&(q=l(r).replaceAll('"${',"${").replaceAll("'${","${").replaceAll('}"',"}").replaceAll("}'","}").replaceAll("this[","$bay.proxy[").replaceAll("this.","$bay.proxy.").replaceAll("  ","").replaceAll("\n","")),this.add_JS_BlobFileToHead(`${M}\n$bay.template = () => {${A}return \`${H}\`;};\n$bay.styles = () => { return \`${q}\`;};${T}`,h),this.hasAdoptedStyleSheets=!1,"adoptedStyleSheets"in document&&(this.hasAdoptedStyleSheets=!0),this.hasAdoptedStyleSheets)this.sheet=new CSSStyleSheet,this.sheet.replaceSync(q),this.shadowDom.adoptedStyleSheets=[this.sheet];else{const e=new Blob([q],{type:"text/css"});let t=URL.createObjectURL(e),n=document.createElement("link");n.rel="stylesheet",n.href=t,this.shadowDom.appendChild(n),n.id="bay-style";let i=document.createElement("link");i.id="bay-style-update",i.href=t,i.rel="stylesheet",this.shadowDom.appendChild(i),this.styleLinkUpdate=i}}apply_events(e,n,i){if(e.name.indexOf(t)>-1)if(e.name.indexOf("data-bay-style")>-1)n.style!==e.value&&(n.style=e.value);else{let a=e.value.replaceAll("window.bay","$bay");-1===this.newEvents.indexOf(`$bay[${i}] = {};`)&&(this.newEvents+=`$bay[${i}] = {};`,this.newEventsArray.push(i)),this.newEvents+=`$bay[${i}]['${e.name}'] = function(e) {${a}};\n`,n[`on${e.name.split(t)[1]}`]=t=>{window.bay[this.uniqid][i]&&window.bay[this.uniqid][i][e.name]&&window.bay[this.uniqid][i][e.name](t)}}}add_events(e){e&&(this.newEvents="",this.newEventsArray=[],e.forEach(((e,t)=>{[...e.attributes].forEach((n=>this.apply_events(n,e,t)))})),this.oldEventsArray.forEach((e=>{-1===this.newEventsArray.indexOf(e)&&delete window.bay[this.uniqid][e]})),this.newEvents&&this.oldEvents!==this.newEvents&&(this.oldEvents=this.newEvents,this.oldEventsArray=this.newEventsArray,this.add_JS_Blob_event(this.newEvents)))}set_styles(){const e=window.bay[this.uniqid].styles();if(this.oldStyles!==e)if(this.oldStyles=e,this.hasAdoptedStyleSheets)this.sheet.replaceSync(e);else{var t=new Blob([e],{type:"text/css"}),n=URL.createObjectURL(t);this.styleLinkUpdate.href=n,URL.revokeObjectURL(n)}}isEqual_fn(e,t){e.forEach(((e,n)=>{var i,a;!t[n].isEqualNode(e)&&t[n]&&(i=e,[...(a=t[n]).attributes].forEach((e=>{"style"!==e.name&&(i.hasAttribute(e.name)||(a.removeAttribute(e.nodeName),v(a,e.nodeName)&&delete a[e.nodeName]))})),[...i.attributes].forEach((e=>{a.hasAttribute(e.nodeName)&&a.getAttribute(e.nodeName)===e.value||a.setAttribute(e.nodeName,e.value),v(a,e.nodeName)&&a[e.nodeName]!==e.value&&(a[e.nodeName]=e.value)}))),e.hasAttribute("data-bay-style")||e.hasAttribute("style")||t[n].removeAttribute("style")}))}render_innerHTML(t){if(!t)return;if("function"!=typeof window.bay[this.uniqid].inner_html)return;window.bay[this.uniqid].template();const n=m(window.bay[this.uniqid].inner_html());_(n,t),this.isEqual_fn([...e(n,"*")],[...e(t,"*")])}render_shadowDOM(){const t=m(window.bay[this.uniqid].template());_(t,this.shadowRootHTML),this.isEqual_fn([...e(t,"*")],[...e(this.shadowRootHTML,"*")])}render_debouncer(){this.debouncer&&window.cancelAnimationFrame(this.debouncer),this.debouncer=window.requestAnimationFrame((()=>{this.render()}))}render(){if(this.CSP_errors)this.shadowDom.innerHTML="";else if(this.original_template&&this.shadowRootHTML.innerHTML&&"function"==typeof window.bay[this.uniqid].template)try{E&&this.render_innerHTML(this.inner_html_target),this.render_shadowDOM(),E?this.add_events([...e(this.inner_html_target,"*"),...e(this.shadowRootHTML,"*")]):this.add_events([...e(this.shadowRootHTML,"*")]),this.set_styles(),!1===this.mounted&&window.bay[this.uniqid].$mounted&&(this.mounted=!0,setTimeout((()=>{window.bay[this.uniqid].$mounted()}),14)),e(this.shadowDom,"[bay]")[0]&&w(this.shadowDom),this.hasAttribute("fouc")&&this.removeAttribute("fouc")}catch(e){}}add_JS_Blob_event(e){return __awaiter(this,void 0,void 0,(function*(){const t=new Blob([`export default () => {"use strict";\n${this.blob_event_prefixes}${e}};`],{type:"text/javascript"}),n=URL.createObjectURL(t);(yield import(n)).default(),URL.revokeObjectURL(n)}))}add_JS_BlobFileToHead(e,t){return __awaiter(this,void 0,void 0,(function*(){if(o[i])yield import(o[i]).then((e=>{e.default(this.uniqid,t),this.after_blob_loaded()}));else{const n=new Blob([`export default (bay_uniqid, parent_uniqid) => {"use strict";\n${e}};`],{type:"text/javascript"}),a=URL.createObjectURL(n);o[i]=a,yield import(a).then((e=>{e.default(this.uniqid,t),this.after_blob_loaded(),h&&URL.revokeObjectURL(a)}))}}))}after_blob_loaded(){this.dsd||(this.original_template=window.bay[this.uniqid].template(),this.shadowDom.getElementById("bay").innerHTML=this.original_template),this.render_debouncer(),this.CSP_errors?this.shadowDom.innerHTML="CSP issue, add blob: to script-src & style-src whitelist.":e(this.shadowDom,"[bay]")[0]&&w(this.shadowDom)}connectedCallback(){try{g&&window.addEventListener("bay_global_event",(e=>{this.render_debouncer()})),L&&window.addEventListener("bay_route_event",(e=>{this.render_debouncer()}))}catch(e){}}static get observedAttributes(){return $}attributeChangedCallback(e,t,n){t!==n&&(this.shadowDom.proxy[e]=n,window.dispatchEvent(this.local_update_evt))}})}window.addEventListener("load",(()=>{w(document)})),bay.refresh=()=>{w(document)},bay.create=function(e,t,n){const i=new DOMParser;let a,o="",r=n||[];t.indexOf("<style>")>-1&&(o=t.split("<style>")[1].split("</style>")[0]),t=t.replaceAll(/<!--[\s\S]*?-->/g,"").replaceAll(`<style>${o}</style>`,""),a=i.parseFromString(t,"text/html"),a&&(customElements.get(e.toLowerCase())||g(a,e.toLowerCase(),r,o,!0))}};export default bay;